


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > EvaluationMenuViewModel</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.zurtar.mhma.mood</a>
</div>

<h1>Coverage Summary for Class: EvaluationMenuViewModel (com.zurtar.mhma.mood)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">EvaluationMenuViewModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
</tr>
  <tr>
    <td class="name">EvaluationMenuViewModel$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.zurtar.mhma.mood
&nbsp;
&nbsp;import android.util.Log
&nbsp;import androidx.compose.ui.graphics.vector.ImageVector
&nbsp;import androidx.compose.ui.platform.LocalView
&nbsp;import androidx.lifecycle.ViewModel
&nbsp;import androidx.lifecycle.viewModelScope
&nbsp;import com.zurtar.mhma.analytics.toDate
&nbsp;import com.zurtar.mhma.analytics.toLocalDate
&nbsp;import com.zurtar.mhma.data.models.BiWeeklyEvaluationEntry
&nbsp;import com.zurtar.mhma.data.BiWeeklyMoodRepository
&nbsp;import com.zurtar.mhma.data.DailyEvaluationEntry
&nbsp;import com.zurtar.mhma.data.DailyMoodRepository
&nbsp;import com.zurtar.mhma.theme.EmojiFrown
&nbsp;import com.zurtar.mhma.theme.EmojiNeutral
&nbsp;import dagger.hilt.android.lifecycle.HiltViewModel
&nbsp;import kotlinx.coroutines.flow.MutableStateFlow
&nbsp;import kotlinx.coroutines.flow.StateFlow
&nbsp;import kotlinx.coroutines.flow.asStateFlow
&nbsp;import kotlinx.coroutines.flow.update
&nbsp;import kotlinx.coroutines.launch
&nbsp;import java.time.Instant
&nbsp;import java.util.Date
&nbsp;import java.time.LocalDate
&nbsp;import javax.inject.Inject
&nbsp;import kotlin.random.Random
&nbsp;
&nbsp;/**
&nbsp; * Daily/Quick Evaluation UI State &amp; ViewModel
&nbsp; */
&nbsp;data class DailyEvaluationUiState(
&nbsp;    val dailyEntry: DailyEvaluationEntry = DailyEvaluationEntry(),
&nbsp;    val isSubmitted: Int = 0,
&nbsp;    val page: Int = 0
&nbsp;)
&nbsp;
&nbsp;@HiltViewModel
&nbsp;class DailyEvaluationViewModel @Inject constructor(
&nbsp;    private val dailyMoodRepository: DailyMoodRepository
&nbsp;) : ViewModel() {
&nbsp;
&nbsp;    private val _uiState = MutableStateFlow(DailyEvaluationUiState())
&nbsp;    val uiState: StateFlow&lt;DailyEvaluationUiState&gt; = _uiState.asStateFlow()
&nbsp;
&nbsp;    fun onSubmit() {
&nbsp;
&nbsp;        val emotionsMap: Map&lt;String, Float&gt; =
&nbsp;            _uiState.value.dailyEntry.selectedEmotions.zip(_uiState.value.dailyEntry.emotionIntensities)
&nbsp;                .sortedByDescending { (_, intensity) -&gt;
&nbsp;                    intensity
&nbsp;                }.toMap()
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(
&nbsp;                isSubmitted = 1,
&nbsp;                dailyEntry = currentState.dailyEntry.copy(
&nbsp;                    emotionsMap = emotionsMap,
&nbsp;                    dateCompleted = LocalDate.now().toDate(),
&nbsp;                    strongestEmotion = emotionsMap.entries.first().toPair()
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;
&nbsp;        viewModelScope.launch {
&nbsp;            dailyMoodRepository.addMoodEntry(
&nbsp;                _uiState.value.dailyEntry.copy(
&nbsp;                    dateCompleted = Date.from(
&nbsp;                        Instant.now()
&nbsp;                    )
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun onNext() {
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(page = currentState.page + 1)
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun onBack() {
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(page = currentState.page - 1)
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun updateEmotion(emoji: ImageVector) {
&nbsp;        val stressLevel = when (emoji) {
&nbsp;            EmojiFrown -&gt; &quot;Very Stressed&quot;
&nbsp;            EmojiNeutral -&gt; &quot;Mildly Stressed&quot;
&nbsp;            else -&gt; &quot;Not Stressed&quot;
&nbsp;        }
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(
&nbsp;                dailyEntry = currentState.dailyEntry.copy(
&nbsp;                    stressLevel = stressLevel
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun emotionSelect(emotion: String) {
&nbsp;        Log.println(Log.DEBUG, &quot;DailyEval:: &quot;, &quot;$emotion&quot;)
&nbsp;
&nbsp;        val emotionList = _uiState.value.dailyEntry.selectedEmotions.toMutableList()
&nbsp;
&nbsp;        if (emotionList.contains(emotion))
&nbsp;            emotionList.remove(emotion)
&nbsp;        else if (emotionList.size &lt; 3) {
&nbsp;            emotionList.add(emotion)
&nbsp;        }
&nbsp;        Log.println(Log.DEBUG, &quot;DailyEval:: &quot;, &quot;$emotionList&quot;)
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            val d_entry = DailyEvaluationEntry(
&nbsp;                selectedEmotions = emotionList,
&nbsp;                emotionIntensities = currentState.dailyEntry.emotionIntensities,
&nbsp;                stressLevel = currentState.dailyEntry.stressLevel,
&nbsp;                dateCompleted = currentState.dailyEntry.dateCompleted
&nbsp;            )
&nbsp;
&nbsp;            currentState.copy(dailyEntry = d_entry)
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun updateIntensity(value: Float, index: Int) {
&nbsp;
&nbsp;        val intensityList = _uiState.value.dailyEntry.emotionIntensities.toMutableList()
&nbsp;        intensityList[index] = value
&nbsp;        Log.println(Log.DEBUG, &quot;DailyEval:: &quot;, &quot;$value&quot;)
&nbsp;
&nbsp;        val emotionsMap: Map&lt;String, Float&gt; =
&nbsp;            _uiState.value.dailyEntry.selectedEmotions.zip(intensityList)
&nbsp;                .sortedByDescending { (_, intensity) -&gt;
&nbsp;                    intensity
&nbsp;                }.toMap()
&nbsp;
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(
&nbsp;                dailyEntry = currentState.dailyEntry.copy(
&nbsp;                    emotionIntensities = intensityList,
&nbsp;                    emotionsMap = emotionsMap
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;        Log.println(Log.DEBUG, &quot;DailyEval:: &quot;, &quot;$intensityList&quot;)
&nbsp;    }
&nbsp;
&nbsp;    fun updateStrongestEmotion() {
&nbsp;        val strongest = _uiState.value.dailyEntry.emotionsMap.entries.first().toPair()
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(
&nbsp;                dailyEntry = currentState.dailyEntry.copy(
&nbsp;                    strongestEmotion = strongest
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;}
&nbsp;
&nbsp;/**
&nbsp; * Bi-Weekly Evaluation UI State &amp; ViewModel
&nbsp; */
&nbsp;data class BiWeeklyEvaluationUiState(
&nbsp;    val biWeeklyEntry: BiWeeklyEvaluationEntry = BiWeeklyEvaluationEntry(),
&nbsp;    val questionResponse: MutableList&lt;Int&gt; = (0..16).map { x -&gt; x * 0 }.toMutableList(),
&nbsp;    val page: Int = 0,
&nbsp;)
&nbsp;
&nbsp;@HiltViewModel
&nbsp;class BiWeeklyEvaluationViewModel @Inject constructor(
&nbsp;    private val biWeeklyMoodRepository: BiWeeklyMoodRepository
&nbsp;) : ViewModel() {
&nbsp;
&nbsp;    private val _uiState = MutableStateFlow(BiWeeklyEvaluationUiState())
&nbsp;    val uiState: StateFlow&lt;BiWeeklyEvaluationUiState&gt; = _uiState.asStateFlow()
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Triggered when Next button is pressed
&nbsp;     * Should increment page count and possibly do verification
&nbsp;     */
&nbsp;    fun onNext() {
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(page = currentState.page + 1)
&nbsp;        }
&nbsp;
&nbsp;        if (_uiState.value.page == _uiState.value.questionResponse.size - 1)
&nbsp;            submitMoodEntry()
&nbsp;    }
&nbsp;
&nbsp;    fun onBack() {
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(page = currentState.page - 1)
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    fun onSelect(selected: Int) {
&nbsp;        val newList = _uiState.value.questionResponse.toMutableList()
&nbsp;        newList[_uiState.value.page] = selected
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(
&nbsp;                questionResponse = newList
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    fun debugScore() {
&nbsp;        val depressionScore = _uiState.value.questionResponse.subList(0, 9).sum()
&nbsp;        val anxietyScore = _uiState.value.questionResponse.subList(9, 15).sum()
&nbsp;
&nbsp;        _uiState.update { currentState -&gt;
&nbsp;            currentState.copy(
&nbsp;                biWeeklyEntry = currentState.biWeeklyEntry.copy(
&nbsp;                    depressionScore = depressionScore,
&nbsp;                    anxietyScore = anxietyScore,
&nbsp;                    dateCompleted = Date.from(Instant.now())
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;
&nbsp;        Log.println(Log.DEBUG, &quot;BiWeeklyEvalVM&quot;, &quot;Depression Score: $depressionScore&quot;)
&nbsp;        Log.println(Log.DEBUG, &quot;BiWeeklyEvalVM&quot;, &quot;Anxiety Score: $anxietyScore&quot;)
&nbsp;    }
&nbsp;
&nbsp;    private fun submitMoodEntry() {
&nbsp;        debugScore();
&nbsp;        /*
&nbsp;                val ran = Random(Instant.now().toEpochMilli())
&nbsp;                val biWeeklyEntries: MutableList&lt;BiWeeklyEvaluationEntry&gt; = mutableListOf()
&nbsp;
&nbsp;                for (i in 0..10) {
&nbsp;                    val date = LocalDate.now().minusWeeks(i.toLong()).toDate()
&nbsp;
&nbsp;                    biWeeklyEntries.add(
&nbsp;                        BiWeeklyEvaluationEntry(
&nbsp;                            depressionScore = ran.nextInt(0, 27),
&nbsp;                            anxietyScore = ran.nextInt(0, 21),
&nbsp;                            dateCompleted = date
&nbsp;                        )
&nbsp;                    )
&nbsp;                }*/
&nbsp;
&nbsp;        viewModelScope.launch {
&nbsp;            biWeeklyMoodRepository.addMoodEntry(
&nbsp;                _uiState.value.biWeeklyEntry.copy(
&nbsp;                    dateCompleted = Date.from(Instant.now())
&nbsp;                )
&nbsp;            )
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;}
&nbsp;
&nbsp;/**
&nbsp; * Evaluation Menu/Landing Page UI State &amp; ViewModel
&nbsp; */
&nbsp;data class EvaluationMenuUiState(
&nbsp;    val isBiWeeklyCompleted: Boolean = false,
&nbsp;    val isDailyEntry: Boolean = false
&nbsp;)
&nbsp;
&nbsp;@HiltViewModel
&nbsp;class EvaluationMenuViewModel @Inject constructor(
<b class="nc">&nbsp;    private val dailyMoodRepository: DailyMoodRepository,</b>
<b class="nc">&nbsp;    private val biWeeklyMoodRepository: BiWeeklyMoodRepository</b>
<b class="nc">&nbsp;) : ViewModel() {</b>
<b class="nc">&nbsp;    private val _uiState = MutableStateFlow(EvaluationMenuUiState())</b>
<b class="nc">&nbsp;    val uiState: StateFlow&lt;EvaluationMenuUiState&gt; = _uiState.asStateFlow()</b>
&nbsp;
<b class="nc">&nbsp;    init {</b>
<b class="nc">&nbsp;        viewModelScope.launch {</b>
<b class="nc">&nbsp;            _uiState.update { c -&gt;</b>
<b class="nc">&nbsp;                c.copy(</b>
<b class="nc">&nbsp;                    isBiWeeklyCompleted = biWeeklyMoodRepository.fetchLatestMoodEntries()</b>
<b class="nc">&nbsp;                        .any { it.dateCompleted?.toLocalDate()?.equals(LocalDate.now()) == true },</b>
&nbsp;
<b class="nc">&nbsp;                    isDailyEntry = dailyMoodRepository.fetchMoodEntries()</b>
<b class="nc">&nbsp;                        .any { it.dateCompleted?.toLocalDate()?.equals(LocalDate.now()) == true }</b>
<b class="nc">&nbsp;                )</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    fun updateBiWeekly() {
<b class="nc">&nbsp;        if (!_uiState.value.isBiWeeklyCompleted) {</b>
<b class="nc">&nbsp;            _uiState.update { currentState -&gt;</b>
<b class="nc">&nbsp;                currentState.copy(isBiWeeklyCompleted = true)</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            _uiState.update { currentState -&gt;</b>
<b class="nc">&nbsp;                currentState.copy(isBiWeeklyCompleted = false)</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-04-03 12:43</div>
</div>
</body>
</html>
